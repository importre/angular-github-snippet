// angular-github-snippet v0.1.0 (2014.03.10)
// Copyright (c) 2014, Jaewe Heo. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.
"use strict";var ghsnip=angular.module("ghsnip",["hljs","base64"]);ghsnip.directive("ghsnip",["$http","$base64","$compile",function(a,b,c){function d(a,b){for(var c,d=[],e=0,f=-1,g=0;g<a.length&&g<b.length;g++)c=a[g],f>=0&&c-f!=1&&(d[e++]=" \n	...omitted...\n"),d[e++]=b[c-1],f=c;return d}function e(a,b){var c='<div class="ghsnip"><h3><a href=\''+a.html_url+"' target='_blank'>"+a.path+"</a></h3><hr/><div hljs>"+b.join(" \n")+"</div></div>";return c}function f(a,c){var f,g=a.content,h=g.split("\n");for(f=0;f<h.length;f++)h[f]=b.decode(h[f]);if(h=h.join("").split("\n"),0===c.length)for(f=0;f<h.length;f++)c[f]=f+1;var i=d(c,h),j=e(a,i);return j}function g(b,d,e){if(e.hasOwnProperty("code")){var g="<div>loading...</div>";d.html(g);var h=b.getGithubApiUrl(e.code);return null===h?(g="<div>Should be a file url.<br/>"+e.code+"</div>",void d.html(g)):void a({method:"GET",url:h}).success(function(a){var g=null;e.hasOwnProperty("lines")&&(g=e.lines),g=b.parseLines(g);var h=f(a,g),i=c(h)(b);d.replaceWith(i)}).error(function(a){d.html(a.message)})}}return{restrict:"E",controller:"ghsnipCtrl",template:"<div></div>",compile:function(){return function(a,b,c){g(a,b,c)}}}}]),ghsnip.controller("ghsnipCtrl",["$scope",function(a){a.parseLines=function(a){var b,c,d,e,f,g=0,h=[],i=function(a){h.indexOf(a)<0&&(h[g++]=a)};if(!a||"string"!=typeof a)return h;for(a=a.split(","),b=0;b<a.length;b++)if(f=a[b],f.indexOf(":")>0){if(f=f.split(":"),2==f.length&&(d=parseInt(f[0]),e=parseInt(f[1]),d&&e&&d>0&&e>0))for(d>e&&(e=[d,d=e][0]),c=d;e>=c;c++)i(c)}else f=parseInt(f),f&&i(f);return h.sort(function(a,b){return a-b}),h},a.getGithubApiUrl=function(a){if(a){if(a.indexOf("api.github.com/")>=0)return a;if(a.indexOf("github.com/")<0||a.indexOf("/blob/")<0)return null;a=a.replace("github.com/","api.github.com/repos/"),a=a.replace("/blob/","/contents/"),a=a.replace(/(.+?)\/contents\/([^\/]+)(.+)/,function(a,b,c,d){return b+"/contents"+d+"?ref="+c})}return a}}]);